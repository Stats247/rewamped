<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Match Intelligence & Prediction System</title>
    
    <!-- Google Fonts: Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        primary: '#2563EB',
                        success: '#16A34A',
                        error: '#DC2626',
                        background: '#F5F7FB',
                    },
                    boxShadow: {
                        'glow': '0 0 15px rgba(37, 99, 235, 0.3)',
                        'card': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #F5F7FB; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2563EB;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .fade-in {
            animation: fadeIn 0.4s ease-out forwards;
            opacity: 0;
            transform: translateY(10px);
        }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }

        .nav-gradient { background: linear-gradient(135deg, #0F172A, #020617); }
        .btn-gradient { background: linear-gradient(135deg, #2563EB, #3B82F6); }
        .btn-gradient:hover { background: linear-gradient(135deg, #1D4ED8, #2563EB); }
        
        .cell-win { background: #DCFCE7 !important; color: #166534 !important; border-radius: 4px; padding: 2px 6px; }
        .cell-loss { background: #FEE2E2 !important; color: #991B1B !important; border-radius: 4px; padding: 2px 6px; }
        
        .goals-over { background: #DCFCE7; color: #166534; font-weight: 700; border-radius: 6px; }
        .goals-under { background: #FEE2E2; color: #991B1B; font-weight: 700; border-radius: 6px; }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        #scroll-top-btn {
            transition: all 0.3s ease;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
        }
        #scroll-top-btn.visible { opacity: 1; visibility: visible; transform: translateY(0); }
        
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="text-slate-800 antialiased min-h-screen flex flex-col font-sans">

    <nav class="nav-gradient text-white sticky top-0 z-40 shadow-xl border-b border-slate-800/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center gap-3">
                    <div class="bg-blue-600/20 p-2 rounded-lg backdrop-blur-sm">
                        <i class="fa-solid fa-chart-line text-blue-400 text-xl"></i>
                    </div>
                    <span class="font-bold text-2xl tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400">Match Intelligence</span>
                </div>
                <div class="flex space-x-6 text-[15px] font-medium">
                    <button onclick="switchTab('all')" id="tab-all" class="relative px-5 py-2.5 rounded-full transition-all duration-300 hover:text-white group">
                        <span>All Matches</span>
                    </button>
                    <button onclick="switchTab('sureMatches')" id="tab-sureMatches" class="relative px-5 py-2.5 rounded-full transition-all duration-300 text-slate-400 hover:text-white group">
                        <i class="fa-solid fa-circle-check text-xs mr-1 opacity-70"></i> 
                        <span>Sure Matches</span>
                    </button>
                    <button onclick="switchTab('sureGoals')" id="tab-sureGoals" class="relative px-5 py-2.5 rounded-full transition-all duration-300 text-slate-400 hover:text-white group">
                        <i class="fa-solid fa-bullseye text-xs mr-1 opacity-70"></i>
                        <span>Sure Goals</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-8">

        <div id="loading-indicator" class="flex flex-col items-center justify-center h-64">
            <div class="loader mb-4"></div>
            <p class="text-slate-500 font-medium animate-pulse">Analyzing Match Data...</p>
        </div>

        <div id="error-message" class="hidden bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded-lg shadow-sm">
            <div class="flex">
                <div class="flex-shrink-0"><i class="fa-solid fa-circle-exclamation text-red-500"></i></div>
                <div class="ml-3"><p class="text-sm text-red-700 font-medium" id="error-text">Error loading data.</p></div>
            </div>
        </div>

        <div id="dashboard-content" class="hidden space-y-8">
            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white rounded-2xl shadow-card p-6 border border-slate-100 relative overflow-hidden group">
                    <div class="absolute right-0 top-0 h-full w-1.5 bg-blue-500/80"></div>
                    <div class="flex justify-between items-start">
                        <div><p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Total Matches</p><h3 class="text-4xl font-bold text-slate-800" id="stat-total">0</h3></div>
                        <div class="p-3 bg-blue-50 rounded-xl text-blue-600"><i class="fa-solid fa-list text-xl"></i></div>
                    </div>
                </div>
                <div class="bg-white rounded-2xl shadow-card p-6 border border-slate-100 relative overflow-hidden group">
                    <div class="absolute right-0 top-0 h-full w-1.5 bg-green-500/80"></div>
                    <div class="flex justify-between items-start">
                        <div><p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Matches Won</p><h3 class="text-4xl font-bold text-slate-800" id="stat-won">0</h3></div>
                        <div class="p-3 bg-green-50 rounded-xl text-green-600"><i class="fa-solid fa-check text-xl"></i></div>
                    </div>
                </div>
                <div class="bg-white rounded-2xl shadow-card p-6 border border-slate-100 relative overflow-hidden group">
                    <div class="absolute right-0 top-0 h-full w-1.5 bg-indigo-500/80"></div>
                    <div class="flex justify-between items-start">
                        <div><p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Win Rate</p><h3 class="text-4xl font-bold text-slate-800" id="stat-rate">0%</h3></div>
                        <div class="p-3 bg-indigo-50 rounded-xl text-indigo-600"><i class="fa-solid fa-percent text-xl"></i></div>
                    </div>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="glass-panel rounded-2xl shadow-card overflow-hidden">
                <div class="flex justify-between items-center p-5 bg-white border-b border-slate-100">
                    <div class="flex items-center gap-3 text-slate-800 font-bold text-lg">
                        <div class="bg-blue-100 p-1.5 rounded-md text-blue-600"><i class="fa-solid fa-sliders"></i></div>
                        Advanced Filtering Panel
                    </div>
                </div>
                
                <div id="filter-panel" class="p-6 space-y-6 bg-white/80">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="space-y-1.5">
                            <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide">Match Date</label>
                            <select id="filter-date" class="w-full bg-white border-slate-200 rounded-lg text-sm py-2 px-3 border shadow-sm focus:ring-2 focus:ring-blue-500">
                                <option value="">All Dates</option>
                            </select>
                        </div>
                        <div class="space-y-1.5">
                            <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide">Home PPG (Min - Max)</label>
                            <div class="flex gap-2">
                                <input type="number" step="0.1" id="filter-h-ppg-min" placeholder="Min" class="w-1/2 bg-white border-slate-200 rounded-lg text-sm py-2 px-2 border shadow-sm">
                                <input type="number" step="0.1" id="filter-h-ppg-max" placeholder="Max" class="w-1/2 bg-white border-slate-200 rounded-lg text-sm py-2 px-2 border shadow-sm">
                            </div>
                        </div>
                        <div class="space-y-1.5">
                            <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide">Away PPG (Min - Max)</label>
                            <div class="flex gap-2">
                                <input type="number" step="0.1" id="filter-a-ppg-min" placeholder="Min" class="w-1/2 bg-white border-slate-200 rounded-lg text-sm py-2 px-2 border shadow-sm">
                                <input type="number" step="0.1" id="filter-a-ppg-max" placeholder="Max" class="w-1/2 bg-white border-slate-200 rounded-lg text-sm py-2 px-2 border shadow-sm">
                            </div>
                        </div>
                        <div class="space-y-1.5">
                            <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide">Total Goals Avg (Min - Max)</label>
                            <div class="flex gap-2">
                                <input type="number" step="0.1" id="filter-goals-min" placeholder="Min" class="w-1/2 bg-white border-slate-200 rounded-lg text-sm py-2 px-2 border shadow-sm">
                                <input type="number" step="0.1" id="filter-goals-max" placeholder="Max" class="w-1/2 bg-white border-slate-200 rounded-lg text-sm py-2 px-2 border shadow-sm">
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center justify-between gap-4 pt-2">
                        <div class="flex gap-4">
                            <div class="flex items-center gap-2 bg-slate-100 px-3 py-1.5 rounded-lg border border-slate-200">
                                <span class="text-[10px] font-bold text-slate-500 uppercase">Status:</span>
                                <span id="active-tab-indicator" class="text-xs font-bold text-blue-600">All Matches</span>
                            </div>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="resetFilters()" class="px-6 py-2 text-sm font-semibold text-slate-600 bg-white border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors">Reset Filters</button>
                            <button onclick="applyFilters()" class="px-8 py-2 text-sm font-bold text-white btn-gradient rounded-lg shadow-md hover:shadow-lg transition-all">Apply Filter Selection</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Table -->
            <div class="bg-white rounded-2xl shadow-card border border-slate-200/60 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-slate-100">
                        <thead>
                            <tr class="bg-[#E8EEF8]">
                                <th class="px-4 py-4 text-left text-[11px] font-bold text-slate-600 uppercase">View</th>
                                <th class="px-4 py-4 text-left text-[11px] font-bold text-slate-600 uppercase">Date</th>
                                <th class="px-4 py-4 text-left text-[11px] font-bold text-slate-600 uppercase">Home Team</th>
                                <th class="px-4 py-4 text-left text-[11px] font-bold text-slate-600 uppercase">Away Team</th>
                                <th class="px-4 py-4 text-center text-[11px] font-bold text-slate-600 uppercase">PPG H</th>
                                <th class="px-4 py-4 text-center text-[11px] font-bold text-slate-600 uppercase">PPG A</th>
                                <th class="px-4 py-4 text-center text-[11px] font-bold text-slate-600 uppercase">Pred</th>
                                <th class="px-4 py-4 text-center text-[11px] font-bold text-slate-600 uppercase">Prob %</th>
                                <th class="px-4 py-4 text-center text-[11px] font-bold text-slate-600 uppercase">Total Goals</th>
                                <th class="px-4 py-4 text-center text-[11px] font-bold text-slate-600 uppercase">Sure Tip?</th>
                                <th class="px-4 py-4 text-center text-[11px] font-bold text-slate-600 uppercase">Sure Goals?</th>
                                <th class="px-4 py-4 text-center text-[11px] font-bold text-slate-600 uppercase">Result</th>
                            </tr>
                        </thead>
                        <tbody id="matches-table-body" class="bg-white divide-y divide-slate-50"></tbody>
                    </table>
                </div>
                
                <div class="bg-white px-6 py-4 flex items-center justify-between border-t border-slate-100">
                    <p class="text-sm text-slate-600">Showing <span class="font-bold" id="page-range">0-0</span> of <span class="font-bold" id="page-total">0</span></p>
                    <div class="inline-flex rounded-lg shadow-sm -space-x-px">
                        <button onclick="changePage(-1)" id="btn-prev" class="px-4 py-2 rounded-l-lg border border-slate-200 bg-white text-sm font-medium hover:bg-slate-50 transition-colors disabled:opacity-50">Previous</button>
                        <button onclick="changePage(1)" id="btn-next" class="px-4 py-2 rounded-r-lg border border-slate-200 bg-white text-sm font-medium hover:bg-slate-50 transition-colors disabled:opacity-50">Next</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <button id="scroll-top-btn" onclick="scrollToTop()" class="fixed bottom-8 right-8 bg-blue-600 text-white p-4 rounded-full shadow-lg hover:bg-blue-700 z-50">
        <i class="fa-solid fa-arrow-up"></i>
    </button>

    <!-- Modal -->
    <div id="match-modal" class="fixed inset-0 z-50 hidden overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 py-10">
            <div class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeModal()"></div>
            <div class="bg-white rounded-2xl text-left overflow-hidden shadow-2xl transform transition-all sm:max-w-5xl w-full z-10 p-4 md:p-8">
                <div class="flex justify-between items-center mb-6 border-b pb-4">
                    <h3 class="text-xl font-bold text-slate-900">Head-to-Head Stats</h3>
                    <button onclick="closeModal()" class="text-slate-400 hover:text-red-500 bg-slate-50 p-2 rounded-full transition-colors"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div id="modal-content" class="space-y-6"></div>
                <div class="mt-8 flex justify-end pt-4 border-t"><button onclick="closeModal()" class="px-8 py-2.5 bg-slate-800 text-white font-bold rounded-lg">Close</button></div>
            </div>
        </div>
    </div>

    <script>
        const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQUFYbJHX1H0BMS-u0JphKwvbvCKsA-HftlURRflFkEncYCbZAZJ98BwBFy3vYcIuo7EQXROWO9JNlA/pub?gid=1019987394&single=true&output=csv';
        const ROWS_PER_PAGE = 20;

        let rawData = [];
        let filteredData = [];
        let currentTab = 'all';
        let currentPage = 1;

        const KEY_MAP = {
            date: "Match Date",
            homeTeam: "Home Team",
            awayTeam: "Away Team",
            homePPG: "Home PPG",
            awayPPG: "Away PPG",
            prediction: "Prediction",
            prob: "Probability %",
            totalGoals: "Total Goals",
            sureTip: "Sure Tip?",
            sureGoals: "Sure Goals?",
            result: "Match Result",
            homeGames: "Home Games Played",
            awayGames: "Away Games Played",
            homeWinPct: "Home Win %",
            awayWinPct: "Away Win %",
            homeFTS: "Home FTS %",
            awayFTS: "Away FTS %",
            homeCS: "Home CS %",
            awayCS: "Away CS %",
            homeBTS: "Home BTS %",
            awayBTS: "Away BTS %",
            homeTGAvg: "Home TG Avg",
            awayTGAvg: "Away TG Avg",
            homeGFAvg: "Home GF Avg",
            awayGFAvg: "Away GF Avg",
            homeGAAvg: "Home GA Avg",
            awayGAAvg: "Away GA Avg",
            homeLeaguePos: "Home League Pos",
            awayLeaguePos: "Away League Pos",
            homeForm8: "Home Form L8 Pos",
            awayForm8: "Away Form L8 Pos",
            homeOff8: "Home Offence L8 Pos",
            awayOff8: "Away Offence L8 Pos",
            homeDef8: "Home Defence L8 Pos",
            awayDef8: "Away Defence L8 Pos"
        };

        document.addEventListener('DOMContentLoaded', () => {
            fetchData();
            window.addEventListener('scroll', () => {
                const btn = document.getElementById('scroll-top-btn');
                btn.classList.toggle('visible', window.scrollY > 300);
            });
        });

        async function fetchData() {
            try {
                const response = await fetch(SHEET_CSV_URL);
                if (!response.ok) throw new Error('Network response was not ok');
                const csvText = await response.text();
                rawData = parseCSV(csvText);
                
                if (rawData.length > 0) {
                    populateDynamicFilters();
                    switchTab('all');
                    document.getElementById('loading-indicator').classList.add('hidden');
                    document.getElementById('dashboard-content').classList.remove('hidden');
                } else {
                    throw new Error('No data found in the sheet');
                }
            } catch (error) {
                document.getElementById('loading-indicator').classList.add('hidden');
                document.getElementById('error-message').classList.remove('hidden');
                document.getElementById('error-text').innerText = "Error: " + error.message;
                console.error(error);
            }
        }

        function parseCSV(text) {
            const lines = text.split('\n').filter(l => l.trim() !== '');
            if (lines.length === 0) return [];
            
            const headers = lines[0].split(',').map(h => h.trim().replace(/^"|"$/g, ''));
            const result = [];
            
            for (let i = 1; i < lines.length; i++) {
                let row = [], inQuote = false, token = '';
                for (let char of lines[i]) {
                    if (char === '"') inQuote = !inQuote;
                    else if (char === ',' && !inQuote) { row.push(token); token = ''; }
                    else token += char;
                }
                row.push(token);

                if (row.length >= headers.length) {
                    const obj = {};
                    headers.forEach((h, idx) => {
                        obj[h] = (row[idx] || '').trim().replace(/^"|"$/g, '');
                    });
                    obj._id = i;
                    obj._status = getWinStatus(obj[KEY_MAP.prediction], obj[KEY_MAP.result]);
                    result.push(obj);
                }
            }
            return result;
        }

        function getWinStatus(pred, res) {
            if (!res || res === '-' || res === '' || res === 'undefined') return 'pending';
            const parts = res.split(/[-–]/);
            if (parts.length !== 2) return 'pending';
            
            const h = parseInt(parts[0]), a = parseInt(parts[1]);
            if (isNaN(h) || isNaN(a)) return 'pending';
            
            const actual = h > a ? '1' : (a > h ? '2' : 'X');
            const p = (pred || '').toString().toUpperCase();
            
            let normP = '';
            if (p === '1' || p.includes('HOME')) normP = '1';
            else if (p === '2' || p.includes('AWAY')) normP = '2';
            else if (p === 'X' || p.includes('DRAW')) normP = 'X';

            if (normP === '') return 'pending';
            return actual === normP ? 'won' : 'lost';
        }

        function populateDynamicFilters() {
            const dates = [...new Set(rawData.map(i => i[KEY_MAP.date]))].filter(v => v && v !== 'undefined').sort();
            const dateEl = document.getElementById('filter-date');
            dateEl.innerHTML = '<option value="">All Dates</option>';
            dates.forEach(v => {
                const opt = document.createElement('option');
                opt.value = v; opt.innerText = v;
                dateEl.appendChild(opt);
            });
        }

        function switchTab(tab) {
            currentTab = tab;
            const indicator = document.getElementById('active-tab-indicator');
            
            ['all', 'sureMatches', 'sureGoals'].forEach(t => {
                const btn = document.getElementById(`tab-${t}`);
                if (t === tab) {
                    btn.className = 'relative px-5 py-2.5 rounded-full transition-all bg-blue-600 text-white shadow-lg';
                    indicator.innerText = btn.innerText.replace(/[\n\t]/g, '').trim();
                } else {
                    btn.className = 'relative px-5 py-2.5 rounded-full transition-all text-slate-400 hover:text-white';
                }
            });
            applyFilters();
        }

        function applyFilters() {
            const fDate = document.getElementById('filter-date').value;
            const hMinVal = document.getElementById('filter-h-ppg-min').value;
            const hMaxVal = document.getElementById('filter-h-ppg-max').value;
            const aMinVal = document.getElementById('filter-a-ppg-min').value;
            const aMaxVal = document.getElementById('filter-a-ppg-max').value;
            const gMinVal = document.getElementById('filter-goals-min').value;
            const gMaxVal = document.getElementById('filter-goals-max').value;

            filteredData = rawData.filter(i => {
                // 1. Tab Logic - Using column specific markers as described
                if (currentTab === 'sureMatches') {
                    // Check if column "Sure Tip?" contains the text "Sure Tip" (or case insensitive version)
                    const val = (i[KEY_MAP.sureTip] || "").toString().trim().toLowerCase();
                    if (!val.includes("sure tip")) return false;
                }
                if (currentTab === 'sureGoals') {
                    // Check if column "Sure Goals?" contains the text "Sure Goals" (or case insensitive version)
                    const val = (i[KEY_MAP.sureGoals] || "").toString().trim().toLowerCase();
                    if (!val.includes("sure goals")) return false;
                }

                // 2. Date Filter
                if (fDate && i[KEY_MAP.date] !== fDate) return false;

                // 3. Numeric Range Filtering
                const hPPG = parseFloat(i[KEY_MAP.homePPG]);
                const aPPG = parseFloat(i[KEY_MAP.awayPPG]);
                const totalG = parseFloat(i[KEY_MAP.totalGoals]);

                if (hMinVal !== "" && (isNaN(hPPG) || hPPG < parseFloat(hMinVal))) return false;
                if (hMaxVal !== "" && (isNaN(hPPG) || hPPG > parseFloat(hMaxVal))) return false;
                if (aMinVal !== "" && (isNaN(aPPG) || aPPG < parseFloat(aMinVal))) return false;
                if (aMaxVal !== "" && (isNaN(aPPG) || aPPG > parseFloat(aMaxVal))) return false;
                if (gMinVal !== "" && (isNaN(totalG) || totalG < parseFloat(gMinVal))) return false;
                if (gMaxVal !== "" && (isNaN(totalG) || totalG > parseFloat(gMaxVal))) return false;

                return true;
            });

            currentPage = 1;
            renderStats();
            renderTable();
        }

        function renderStats() {
            const total = filteredData.length;
            const finished = filteredData.filter(d => d._status !== 'pending');
            const won = finished.filter(d => d._status === 'won').length;
            const rate = finished.length > 0 ? (won / finished.length * 100).toFixed(1) : 0;
            document.getElementById('stat-total').innerText = total;
            document.getElementById('stat-won').innerText = won;
            document.getElementById('stat-rate').innerText = rate + '%';
        }

        function renderTable() {
            const tbody = document.getElementById('matches-table-body');
            tbody.innerHTML = '';
            
            if (filteredData.length === 0) {
                tbody.innerHTML = `<tr><td colspan="12" class="px-4 py-20 text-center text-slate-400 font-medium italic">No matches found in this category.</td></tr>`;
                updatePagination(0, 0);
                return;
            }

            const start = (currentPage - 1) * ROWS_PER_PAGE;
            const pageData = filteredData.slice(start, start + ROWS_PER_PAGE);

            pageData.forEach((row) => {
                const tr = document.createElement('tr');
                tr.className = 'fade-in hover:bg-slate-50 transition-all';
                
                let goalsClass = 'text-slate-600 font-semibold';
                const resVal = row[KEY_MAP.result];
                if (resVal && resVal !== '-' && resVal !== 'undefined') {
                    const scores = resVal.split(/[-–]/);
                    if (scores.length === 2) {
                        const sum = parseInt(scores[0]) + parseInt(scores[1]);
                        if (!isNaN(sum)) {
                            goalsClass = (sum > 2.5) ? 'goals-over px-2' : 'goals-under px-2';
                        }
                    }
                }

                const p = (row[KEY_MAP.prediction] || "").toString().toUpperCase();
                const isHomePred = p === '1' || p.includes('HOME');
                const isAwayPred = p === '2' || p.includes('AWAY');
                const homeClass = (isHomePred && row._status === 'won') ? 'cell-win' : (isHomePred && row._status === 'lost' ? 'cell-loss' : '');
                const awayClass = (isAwayPred && row._status === 'won') ? 'cell-win' : (isAwayPred && row._status === 'lost' ? 'cell-loss' : '');

                tr.innerHTML = `
                    <td class="px-4 py-4"><button onclick="openModal(${row._id})" class="px-2 py-1 bg-blue-600 text-white rounded text-[10px] font-bold shadow-sm hover:bg-blue-700">View</button></td>
                    <td class="px-4 py-4 text-[11px] text-slate-500">${row[KEY_MAP.date] || '-'}</td>
                    <td class="px-4 py-4"><span class="${homeClass} text-xs font-bold text-slate-700">${row[KEY_MAP.homeTeam] || '-'}</span></td>
                    <td class="px-4 py-4"><span class="${awayClass} text-xs font-bold text-slate-700">${row[KEY_MAP.awayTeam] || '-'}</span></td>
                    <td class="px-4 py-4 text-center text-xs font-bold">${row[KEY_MAP.homePPG] || '0'}</td>
                    <td class="px-4 py-4 text-center text-xs font-bold">${row[KEY_MAP.awayPPG] || '0'}</td>
                    <td class="px-4 py-4 text-center"><span class="px-2 py-0.5 bg-blue-50 text-blue-700 font-bold rounded text-[10px]">${row[KEY_MAP.prediction] || '-'}</span></td>
                    <td class="px-4 py-4 text-center text-xs font-bold">${row[KEY_MAP.prob] || '0'}%</td>
                    <td class="px-4 py-4 text-center"><div class="inline-block ${goalsClass}">${row[KEY_MAP.totalGoals] || '0'}</div></td>
                    <td class="px-4 py-4 text-center text-xs font-medium text-slate-500">${row[KEY_MAP.sureTip] || '-'}</td>
                    <td class="px-4 py-4 text-center text-xs font-medium text-slate-500">${row[KEY_MAP.sureGoals] || '-'}</td>
                    <td class="px-4 py-4 text-center font-bold text-slate-900">${row[KEY_MAP.result] || '-'}</td>
                `;
                tbody.appendChild(tr);
            });

            updatePagination(start, filteredData.length);
        }

        function updatePagination(start, total) {
            const end = Math.min(start + ROWS_PER_PAGE, total);
            document.getElementById('page-range').innerText = `${total > 0 ? start + 1 : 0}-${end}`;
            document.getElementById('page-total').innerText = total;
            document.getElementById('btn-prev').disabled = currentPage === 1;
            document.getElementById('btn-next').disabled = end >= total;
        }

        function openModal(id) {
            const m = rawData.find(d => d._id === id);
            const content = document.getElementById('modal-content');
            
            const statsRows = [
                { label: "Games Played", home: m[KEY_MAP.homeGames], away: m[KEY_MAP.awayGames] },
                { label: "Win %", home: m[KEY_MAP.homeWinPct], away: m[KEY_MAP.awayWinPct] },
                { label: "FTS %", home: m[KEY_MAP.homeFTS], away: m[KEY_MAP.awayFTS] },
                { label: "CS %", home: m[KEY_MAP.homeCS], away: m[KEY_MAP.awayCS] },
                { label: "BTS %", home: m[KEY_MAP.homeBTS], away: m[KEY_MAP.awayBTS] },
                { label: "TG Avg", home: m[KEY_MAP.homeTGAvg], away: m[KEY_MAP.awayTGAvg] },
                { label: "GF Avg", home: m[KEY_MAP.homeGFAvg], away: m[KEY_MAP.awayGFAvg] },
                { label: "GA Avg", home: m[KEY_MAP.homeGAAvg], away: m[KEY_MAP.awayGAAvg] },
                { label: "League Pos", home: m[KEY_MAP.homeLeaguePos], away: m[KEY_MAP.awayLeaguePos] },
                { label: "Form L8 Pos", home: m[KEY_MAP.homeForm8], away: m[KEY_MAP.awayForm8] },
                { label: "Offence L8 Pos", home: m[KEY_MAP.homeOff8], away: m[KEY_MAP.awayOff8] },
                { label: "Defence L8 Pos", home: m[KEY_MAP.homeDef8], away: m[KEY_MAP.awayDef8] }
            ];

            content.innerHTML = `
                <div class="grid grid-cols-2 gap-px bg-slate-200 rounded-xl overflow-hidden shadow-sm border border-slate-200">
                    <div class="bg-blue-600 p-6 text-center text-white">
                        <p class="text-[10px] font-bold uppercase opacity-80 mb-1">Home Team</p>
                        <h4 class="text-xl font-bold">${m[KEY_MAP.homeTeam] || '-'}</h4>
                    </div>
                    <div class="bg-slate-800 p-6 text-center text-white">
                        <p class="text-[10px] font-bold uppercase opacity-80 mb-1">Away Team</p>
                        <h4 class="text-xl font-bold">${m[KEY_MAP.awayTeam] || '-'}</h4>
                    </div>
                </div>
                
                <div class="bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm">
                    <div class="bg-slate-50 border-b border-slate-200 px-6 py-2 grid grid-cols-12 text-[10px] font-bold text-slate-400 uppercase tracking-widest">
                        <div class="col-span-3 text-center">Home</div>
                        <div class="col-span-6 text-center">Statistic</div>
                        <div class="col-span-3 text-center">Away</div>
                    </div>
                    <div class="px-6 py-2 divide-y divide-slate-50">
                        ${statsRows.map(s => `
                            <div class="grid grid-cols-12 items-center py-2.5">
                                <div class="col-span-3 text-base font-bold text-slate-700 text-center">${s.home || '-'}</div>
                                <div class="col-span-6 text-center">
                                    <span class="text-[10px] font-bold text-slate-500 uppercase px-3 py-1 bg-slate-100 rounded-full">${s.label}</span>
                                </div>
                                <div class="col-span-3 text-base font-bold text-slate-700 text-center">${s.away || '-'}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            document.getElementById('match-modal').classList.remove('hidden');
        }

        function resetFilters() {
            document.querySelectorAll('#filter-panel input').forEach(i => i.value = '');
            document.querySelectorAll('#filter-panel select').forEach(s => s.value = '');
            applyFilters();
        }

        function changePage(d) {
            currentPage += d;
            renderTable();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function closeModal() { document.getElementById('match-modal').classList.add('hidden'); }
        function scrollToTop() { window.scrollTo({ top: 0, behavior: 'smooth' }); }
    </script>
</body>
</html>
